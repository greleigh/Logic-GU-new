{%- if site.debug or page.debug -%}{%- assign debug_mode = true -%}{%- endif -%}

{% assign display_categories = page.display_categories %}
{% unless display_categories %}
  {% assign display_categories = site.display_categories %}
{% endunless %}

<ul class="post-list">

  {%- if page.pagination.enabled -%}
    {%- assign postlist = paginator.posts | where_exp:"item", "display_categories contains item.categories.first" -%}
  {%- else -%}
    {%- assign postlist = site.posts | where_exp:"item", "display_categories contains item.categories.first" -%}
  {%- endif -%}

  {% if debug_mode %}Found {{ postlist | size }} posts{% endif %}

  {% for post in postlist %}

  <li>
    {% capture speaker -%}{{ post.speaker }}{%- if post.affil %} ({{ post.affil }}){%- endif -%}{% endcapture %}

    <a class="post-title" href="{{ post.url | relative_url }}">
    <h3>{{ post.title }}</h3><h4>{{ speaker }}</h4>
    </a>

    <div class="post-body">
      {%- if debug_mode -%}<p>excerpt: {{ post.excerpt | inspect }}</p><p>content: {{ post.content | markdownify | inspect }}</p>{%- endif -%}
      {%- assign excerptParts = post.content | split: "<!--more-->" -%}
      {%- if debug_mode -%}<p>Part 1: {{ excerptParts[0] | inspect }}</p><p>Part 2: {{ excerptParts[1] | inspect }}</p>{%- endif -%}
      {%- if excerptParts[1] != nil -%}
        {%- if debug_mode -%}more content than excerpt{%- endif -%}
        <details>
          <summary><div>{{ excerptParts[0] | markdownify }}</div></summary>
          {{ excerptParts[1] | markdownify}}
        </details>
      {%- else -%}
        {%- if debug_mode -%}<p>Only content:</p>{%- endif -%}
        {{ post.content | markdownify }}
      {%- endif -%}
    </div>
    <div class="post-footer">
      <div class="post-meta">
          <time datetime="{{ post.date }}"><i class="fa-solid fa-calendar fa-sm"></i> {{ post.date | date: '%A, %-d %B %Y, %H:%M' }}</time> <!-- </a> -->
          <!-- {% if tags != "" %}
          &nbsp; &middot; &nbsp;
            {% for tag in post.tags %}
            <a href="{{ tag | slugify | prepend: '/blog/tag/' | prepend: site.baseurl}}">
              <i class="fa-solid fa-hashtag fa-sm"></i> {{ tag }}</a> &nbsp;
              {% endfor %}
          {% endif %} -->
          {% if categories != "" %}
          &nbsp; &middot; &nbsp;
            {% for category in post.categories %}
              {% include snippets/show_category.liquid 
                category = category
                active = true
                %}
            {% endfor %}
          {% endif %}
        </div>
    </div>
  </li>

  {% endfor %}
</ul>

{%- if page.pagination.enabled -%}
  {%- include pagination.html -%}
{%- endif -%}